# 1주차 : Memory Hierarcy란? Memory의 종류

어떠한 프로그램을 빠르게 동작하기 위해서는 시간적 지역성과 공간적 지역성을 가져야 한다. 컴퓨터의 메모리를 메모리 계층구조로 구현함으로써 지역성의 원칙을 이용할 수 있는데, 이 메모리 계층구조에는 서로 다른 속도와 크기를 가지는 여러 계층의 메모리로 구성되어 있다. 빠른 메모리는 프로세서에 가깝게 두고, 느리고 싼 메모리를 그 아래에 둠으로써 사용자에게 가장 빠른 메모리가 가지고 있는 접근 속도를 제공하면서 동시에 가장 싼 기술로 최대한 큰 메모리 용량을 제공하는 것이다.

최근에 접근했던 데이터들을 프로세서에 가까이에 보관함으로써 시간적 지역성을 이용하고 메모리의 상위 계층으로 필요한 데이터뿐만 아니라 이와 인접한 다량의 데이터들로 이루워진 블록들을 옮김으로써 공간적 지역성을 이용한다.

메모리의 접근 속도는 적중률에 관련이 되어있다. 적중률이 충분히 크면 프로세서와 가장 가까이에 있는 메모리에서 데이터를 가져올 수 있지만, 그렇지 않을 경우 그 보다 멀리 있는 메모리에서 가져와야 한다.

말 그대로 계층적이므로, 상단층에 없는 데이터가 하단층에 있을 수 없다.

오늘날 사용되는 메모리 계층구조에서는 네 가지 주요 기술이 사용된다. 메인메모리는 DRAM으로 구현하고, 프로세서에 더 가까운 계층인 캐시는 SRAM 이 사용된다. 여기서 DRAM은 SRAM보다 훨씬 느리지만 비트당 가격이 저렴하다. DRAM은 메모리 비트당 면적이 훨씬 작고 따라서 같은 크기의 실리콘으로 더 큰 용량을 만들 수 있다.

플래시 메모리는 비휘발성 메모리로 개인용 휴대기기에서 2차 메모리로 사용된다. 서버의 가장 크고 가장 느린 계층 구현에 사용되는 메모리는 디스크 메모리이다. 여기서 캐시메모리인 SRAM 은 세부적으로 L1, L2... 등 다단계 캐시를 이용해 성능을 추가로 향상할 수 있다.

이 4가지의 주요 기술을 상세히 알아보면 다음과 같다.

**① SRAM**은 읽기나 쓰기를 제공하는 접근 포트가 일반적으로 하나 있는 메모리 배열로 구성된 집적회로이다. 어떤 데이터든지 접근 시간이 같지만, 읽기 접근 시간과 쓰기 접근 시간은 다를 수 있다. Static RAM 이므로 리프레시가 필요 없어서 접근 시간은 사이클 시간과 거의 같다. 정보가 바뀌지 않게 하기 위하여 비트당 6개에서 8개의 트랜지스터를 사용한다. 대기 모드에서는 데이터값을 유지하기 위하여 최소한의 전력만을 사용한다. 이 때 전력이 공급되는 한 그 값이 무한히 유지된다.

**② DRAM**은 셀에 기억되는 값이 전하의 형태로 커패시터에 저장된다. 저장된 값을 읽거나 새로 쓰기 위하여 저장된 전하에 접근하는 데 트랜지스터를 하나 사용한다. 저장된 비트 하나당 트랜지스터를 하나만 사용하므로 SRAM에 비하여 훨씬 더 집적도가 높고 값도 싸다. 커패시터에 전하를 저장하는 Dynamic RAM 이므로 무한히 저장이 불가능해 주기적으로 리프레시가 필요하다. 이러한 이유로 SRAM은 정적 저장이라고 하는 반면 DRAM은 동적 저장이라고 부른다.이 셀을 리프레시하기 위해서는 단순히 저장된 값을 읽고 다시 쓰면 된다. 전하는 수밀리초 동안 유지될 수 있다. 만약 모든 비트를 하나씩 DRAM에서 읽어서 다시 쓴다면, 계속 DRAM을 리프레시만 하다가 기억된 값에 접근할 시간이 없게 되는데 이를 방지하기 위해 DRAM은 2단계 디코딩 구조를 갖는다. 이 구조를 통해 읽기 사이클에서 전체 행을 한꺼번에 읽은 후 바로 쓰기를 하여, 한 행을 통째로 리프레시 할 수 있도록 해준다.

이 리프레시에 도움이 되는 행 구조는 성능 향상에도 도움이 된다. 행을 버퍼링 해서 반복적으로 접근함으로써 버퍼는 SRAM처럼 동작하게 되고, 다음 행 접근 때까지는 주소값만 바꾸면 버퍼 내의 아무 비트나 접근할 수 있게 된다. 이 기능으로 같은 행 내의 비트 접근 시간을 훨씬 줄여 주므로 접근 시간을 크게 개선할 수 있다.

칩을 더 크게 만들면 칩의 메모리 대역폭 또한 커지게 되고, 어떤 행이 버퍼에 있으면 DRAM의 폭이 얼마든지 간에 연속된 주소를 사용하거나 버퍼 내 시작 주소와 블록 전송을 이용해서 전송할 수 있다.

프로세서와의 인터페이스를 더욱 향상시키기 위해 DRAM에 클럭을 추가할 수 있는데 이것을 동기화 DRAM 또는 SDRAM 이라고 부른다. SDRAM의 장점은 클럭을 사용하므로 메모리와 프로세서를 동기화하는 시간이 필요 없다는 것인데, 추가 주소지정 대신 클럭이 연속적인 비트들을 버스트 모드로 전송할 수 있게 하기 때문에 속도가 빠르다. 가장 빠른 버전은 DDR(Double Data Rate) SDRAM 이라고 부른다. 이 이름은 클럭의 상승 에지와 하강 에지에서 각각 데이터가 전송되는 것을 의미한다. 클럭과 데이터 전송 폭으로부터 2배의 대역폭을 가능하게 하고, 요즘 PC에서 사용하는 버전은 DDR4 이다. 예를들어, 삼성전자의 DDR4-3200 DRAM 은 초당 3200 × 106 번의 전송을 하며, 1600MHz 클럭을 사용한다. 이처럼 큰 대역폭을 유지하기 위해서는 DRAM 내부에 좋은 구조가 필요하다.

단순하게 더 빠른 행 버퍼를 사용하는 대신, 내부적으로 여러 뱅크에서 일기와 쓰기가 가능하도록 구성하는 것이다. 각각의 뱅크에 자신의 행 버퍼를 가지고 있고 여러 뱅크에 주소를 보낼 수 있게 하여 동시에 읽고 쓰기가 가능하도록 하는 것이다. 예를 들어 뱅크가 4개라면, 한 번의 접근시간으로 4배의 대역폭을 제공하기 위해 4개의 뱅크를 돌아가면서 접근하는것인데 이 순환 접근 방식을 주소 인터리빙 방식이라고 한다.

개인용 모바일 장치는 낱개 DRAM을 사용하지만, 서버용, 일반 PC용 메모리는 DIMM(Dual Inline Memory Module)이라고 불리는 작은 기판 형태로 판매 된다. DIMM에는 4~16개의 DRAM 이 있으며 서버 시스템용으로 8바이트폭으로 구성된다. DDR4-3200 SDRAM을 사용하는 DIMM 은 초당 8 × 3200의 25,600MB를 전송할 수 있다. 이런 DIMM은 대역폭 크기에 따라 이름을 붙여 PC25600이라 한다.

**③ 플래시 메모리**는 전기적으로 지울 수 있고 프로그래밍이 가능한 EEPROM(Electrically Erasable Programmabl

e Read-Only Memory) 의 한 종류이다. 디스크나 DRAM과는 달리 플래시 메모리의 쓰기는 비트를 마모시키며, 이 단점을 극복하기 위하여 대부분의 플래시 제품은 여러 번 쓰기가 수행된 블록을 덜 사용된 블록에 재맵핑해서 쓰기를 분산시키는 제어기를 사용한다. 이 작업은 마모 균등화라고 한다. 마모 균등화를 사용하기 때문에 개인용 이동 단말기의 플래시가 잠재적 쓰기 한계를 넘는 경우는 거의 없다. 마모 균등화가 플래시의 잠재적 성능을 떨어뜨리지만, 상위 계층 소프트웨어가 각 블록의 마모를 관리하지 않는 한 사용할 수 밖에 없다.

**④ 디스크 메모리**는 하드디스크를 의미하며 오늘날 2.5인치와 3.5인치 사이즈를 주로 사용한다. 하드디스크는 원판의 집합으로 구성되어 있고 원판은 분당 5400번에서 15000번의 속도로 회전한다. 금속 원판의 양측 면은 자성체로 코팅이 되어 있다. 하드디스크상의 정보를 읽거나 쓰기 위해서는 읽기/쓰기 헤드라고 불리는 작은 전자기 코일을 갖고 있는 움직이는 암이 필요하다. 각 디스크의 표면은 트랙이라고 불리는 동심원으로 나누워지며 일반적으로 표면당 수만 개의 트랙이 존재한다. 각 트랙은 다시 정보를 담는 섹터로 나누어지며, 한 트랙당 수천 개의 섹터로 구성된다. 섹터는 일반적으로 512바이트에서 4096바이트의 크기를 가진다. 각 면의 디스크 헤드는 서로 연결되어 있어서 함께 움직이므로 모든 헤드는 각 면의 같은 트랙에 위치하게 된다. 모든 면의 한 점에 위치한 헤드 아래에 놓인 모든 트랙은 실린더라고 불린다.

자기 디스크와 반도체 메모리 기술 사이의 두 가지 큰 차이점은 디스크는 기계 장치이므로 접근 시간이 길지만, 적당한 가격에 아주 높은 저장 용량을 갖으면서 훨씬 저렴하다. 그리고 플래시와 같이 비휘발성이지만 플래시와는 다르게 마모 문제가 없다. 하지만, 플래시가 훨씬 튼튼해서 거친 환경에서 사용되는 개인용 휴대기기와 더 잘 맞는다.

실제로 비교해보면 하드디스크에 비해 플래시메모리는 1000배 정도 빠르고 DRAM은 100000배 정도 빠르다. 가격적인 측면에서도 하드디스크가 10배에서 100배 정도 싸다.